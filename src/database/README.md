# Database Setup Instructions

## Setting up Supabase

1. **Create a Supabase Project**
   - Go to [supabase.com](https://supabase.com)
   - Create a new project
   - Save your project URL and API keys

2. **Run the Schema**
   - Open your Supabase dashboard
   - Go to the SQL Editor
   - Copy the contents of `schema.sql`
   - Execute the script

3. **Configure Environment Variables**
   - Copy `.env.example` to `.env`
   - Add your Supabase URL and keys:
     ```
     SUPABASE_URL=https://your-project.supabase.co
     SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
     SUPABASE_ANON_KEY=your-anon-key
     ```

4. **JWT Secret**
   - The JWT secret is automatically generated by Supabase
   - Find it in: Settings > API > JWT Settings
   - Copy the JWT Secret to your `.env` file

## Database Structure

### Core Tables
- **users** - User profiles (extends Supabase auth)
- **projects** - Project information
- **project_members** - Many-to-many relationship for project access
- **prds** - Product Requirements Documents
- **prd_versions** - Version history for PRDs
- **tasks** - Task tracking
- **comments** - Comments on PRDs and tasks
- **documents** - File uploads and documentation
- **notifications** - User notifications
- **audit_logs** - Audit trail for all actions

### Integration Tables
- **github_integrations** - GitHub repository connections
- **github_commits** - Tracked commits from webhooks
- **deployments** - Deployment tracking

## Row Level Security (RLS)

All tables have RLS enabled to ensure data security:
- Users can only access projects they're members of
- Notifications are private to each user
- Audit logs are protected

## Functions and Triggers

- **update_updated_at_column()** - Automatically updates timestamps
- **handle_new_user()** - Creates user profile on signup

## Storage Buckets

Create these storage buckets in Supabase:
1. **documents** - For project documents
2. **avatars** - For user avatars
3. **project-files** - For project-related files

Configure bucket policies to match your security requirements.
